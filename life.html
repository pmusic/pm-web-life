<!DOCTYPE HTML>
<html>
<head>
<style type="text/css">

#ecosystem {
	width:1000px;
	height:1000px;
	border:black 1px solid;
	position:relative;
}

.on{
	background-color:red;
}

.off{
	background-color:gray;
}

.square {
	width:25px;
	height:25px;
	position:absolute;
}
</style>

<script>

// number of boxes 
var width = 40;
var height = 40;
//Size of square in px.
var square = 25;
// id for setInterval
var interval = null;


/** 
creates 2d array
*/
function createGrid(){
	var g = new Array(height);
	for( var x=0; x<height; x++ ){
		g[x] = new Array(width);
	}

	return g;
}

// create faux-2d array
var grid = createGrid();


window.onload = function setup(){

	var ecosystem = document.getElementById('ecosystem');

	for( var x=0; x<width; x++ ){
		for( var y=0; y<height; y++ ){
			var box = document.createElement('div');
			box.id = 'b-' + x + '-' + y;
			box.className = 'square off';
			box.style.top = y*square + 'px';
			box.style.left = x*square + 'px';
			box.setAttribute( 'onclick', 'javascript:clicked(\''+x+'\', \''+y+'\')' );

			ecosystem.appendChild( box );
		}
	}
} //end setup()


function tick(){
	var tempGrid = createGrid();

	for( var x=0; x<width; x++ ){
		for( var y=0; y<height; y++ ){
			var neighbors = countNeighbors( x, y );

			if( grid[x][y] && ( neighbors == 2 || neighbors == 3 )){
				tempGrid[x][y] = true;
			} else if( grid[x][y] == null && neighbors == 3 ){ 
				tempGrid[x][y] = true;
			}
		}
	}

	grid = tempGrid;
	drawGame();
}

/**

*/
function drawGame(){
	for( var x=0; x<width; x++ ){
		for( var y=0; y<height; y++ ){
			var div = document.getElementById( 'b-' + x + '-' + y );
			if( grid[x][y] ){
				div.className = 'square on';
			} else {
				div.className = 'square off';
			}
		}
	}
}

function randomizeGame(){

	// Odds that any give square will be alive
	var odds = .5;

	for( var x=0; x<width; x++ ){
		for( var y=0; y<height; y++ ){
			if( Math.random() > odds ){
				grid[x][y] = true;
			} else {
				grid[x][y] = null;
			}
		}
	}
	drawGame();
}

/**
@return int
*/
function countNeighbors( x, y ){
	
	var neighbors = 0;
	for( var m = x-1; m<=x+1; m++ ){
		for( var n = y-1; n<=y+1; n++ ){
			if( (m==x && n==y ) || m<0 || n<0 || m>=width || n>=height){
				continue;
			}
			if( grid[m][n] ){
				neighbors++;
			}
		}
	}
	return neighbors;		
}

/**
Called when a box is clicked
*/
function clicked( x, y ){

	// update grid
	if(	grid[x][y] == null ){
		grid[x][y] = true;
		document.getElementById( 'b-' + x + '-' + y ).className = 'square on';
	} else {
		grid[x][y] = null;
		document.getElementById( 'b-' + x + '-' + y ).className = 'square off';
	}
}

function playpause(){

	var button = document.getElementById('playpause');
	if( interval === null ){ //not running; start
		interval = setInterval( function(){tick()},1000 );
		button.innerHTML = 'Pause';
	} else {
		clearInterval( interval );
		interval = null;
		button.innerHTML = 'Play';
	}
}

/**
clear grid
*/
function clearGrid(){
	grid = createGrid();
	drawGame();
}

</script>

</head>
<body>

<div id="ecosystem">
</div>
<button onclick="javascript:tick()">Step</button>
<button onclick="javascript:playpause()" id="playpause">Play</button>
<button onclick="javascript:clearGrid()">Clear</button>
<button onclick="javascript:randomizeGame()">Randomize</button>
</body>
</html>